# Reporting & Analytics

> **Module**: 13 - Reporting & Analytics
> **Stories**: US-13.1 to US-13.5
> **Priority**: P1 (High)
> **Integration**: Dinas Kesehatan, Kemenkes reporting

---

## US-13.1: Daily Operational Reports

### User Story
**As a** clinic manager
**I want to** view daily operational reports
**So that** I can monitor clinic performance

### Acceptance Criteria

- [ ] **GIVEN** operational day ends
      **WHEN** viewing daily report
      **THEN** system shows visits, revenue, and key metrics

### Daily Reports

```yaml
daily_visit_report:
  report_date: date

  # Summary
  total_visits: integer
  new_patients: integer
  returning_patients: integer

  # By polyclinic
  visits_by_polyclinic:
    - polyclinic: string
      total: integer
      bpjs: integer
      general: integer

  # By practitioner
  visits_by_practitioner:
    - practitioner: string
      polyclinic: string
      total: integer

  # By hour
  visits_by_hour:
    - hour: integer
      count: integer

  # Queue metrics
  queue_metrics:
    avg_wait_time_minutes: decimal
    avg_service_time_minutes: decimal
    max_wait_time_minutes: integer
    patients_skipped: integer
    patients_no_show: integer

daily_revenue_report:
  report_date: date

  # Summary
  gross_revenue: decimal
  discounts: decimal
  net_revenue: decimal

  # By category
  revenue_by_category:
    - category: string
      amount: decimal
      count: integer

  # By payment method
  revenue_by_payment:
    - method: string
      amount: decimal
      transaction_count: integer

  # By payer
  revenue_by_payer:
    self_pay: decimal
    bpjs: decimal
    insurance: decimal
    corporate: decimal

  # Outstanding
  outstanding_invoices: integer
  outstanding_amount: decimal

daily_pharmacy_report:
  report_date: date

  # Prescriptions
  total_prescriptions: integer
  prescriptions_dispensed: integer
  prescriptions_pending: integer

  # Revenue
  pharmacy_revenue: decimal

  # Stock alerts
  items_below_minimum: integer
  items_expiring_soon: integer

daily_lab_report:
  report_date: date

  # Orders
  total_orders: integer
  orders_completed: integer
  orders_pending: integer

  # TAT
  avg_tat_minutes: integer
  within_target_tat: integer
  exceeded_tat: integer

  # Critical values
  critical_values_reported: integer
```

---

## US-13.2: Disease Statistics (10 Besar Penyakit)

### User Story
**As a** clinic manager
**I want to** see top diseases by ICD-10 code
**So that** I can understand disease patterns

### Acceptance Criteria

- [ ] **GIVEN** period is selected
      **WHEN** generating disease report
      **THEN** system shows top 10 diagnoses with demographics

### Data Model

```yaml
disease_statistics:
  period_start: date
  period_end: date
  polyclinic: string (nullable - all if null)

  # Top 10
  top_diseases:
    - rank: integer
      icd10_code: string
      disease_name: string
      total_cases: integer
      new_cases: integer
      returning_cases: integer

      # Demographics
      male_count: integer
      female_count: integer
      age_0_5: integer
      age_6_17: integer
      age_18_59: integer
      age_60_plus: integer

  # Trends
  monthly_trends:
    - month: string
      disease: string
      count: integer

  # By polyclinic
  diseases_by_polyclinic:
    - polyclinic: string
      top_5: array[{code, name, count}]

morbidity_report:
  period_month: integer
  period_year: integer

  # Age groups
  by_age_group:
    - age_group: string
      diseases: array[{code, name, count}]

  # Gender
  by_gender:
    - gender: string
      diseases: array[{code, name, count}]

  # Chronic conditions
  chronic_conditions:
    - condition: string
      icd10_code: string
      active_patients: integer
      new_diagnoses: integer
```

---

## US-13.3: KIA & Immunization Indicators

### User Story
**As a** KIA coordinator
**I want to** monitor KIA program indicators
**So that** maternal and child health targets are met

### Acceptance Criteria

- [ ] **GIVEN** period is selected
      **WHEN** viewing KIA report
      **THEN** system shows K1-K4 coverage and immunization rates

### KIA Reports

```yaml
kia_anc_report:
  period_month: integer
  period_year: integer

  # Coverage
  pregnant_women_registered: integer
  k1_visits: integer
  k1_coverage_percent: decimal
  k4_visits: integer
  k4_coverage_percent: decimal

  # High risk
  high_risk_identified: integer
  high_risk_referred: integer

  # Delivery
  deliveries_this_month: integer
  deliveries_at_facility: integer
  deliveries_by_skilled_attendant: integer

  # Complications
  complications_identified: integer
  complications_managed: integer
  maternal_deaths: integer

kia_pnc_report:
  period_month: integer
  period_year: integer

  # Coverage
  deliveries: integer
  kn1_visits: integer
  kn1_coverage_percent: decimal
  kn3_visits: integer
  kn3_coverage_percent: decimal

  # Issues
  postpartum_complications: integer
  neonatal_complications: integer
  neonatal_deaths: integer

immunization_report:
  period_month: integer
  period_year: integer

  # Targets
  target_population:
    - vaccine: string
      target_count: integer

  # Coverage
  immunization_coverage:
    - vaccine: string
      target: integer
      achieved: integer
      coverage_percent: decimal
      dropout_rate: decimal

  # By vaccine
  vaccines_administered:
    - vaccine: string
      dose_1: integer
      dose_2: integer
      dose_3: integer
      booster: integer

  # AEFI (Adverse Events Following Immunization)
  aefi_reported: integer
  aefi_serious: integer

child_growth_report:
  period_month: integer
  period_year: integer

  # Assessed
  children_assessed: integer

  # Nutrition status
  nutrition_status:
    normal: integer
    underweight: integer
    severely_underweight: integer
    overweight: integer

  # Stunting
  stunting:
    normal: integer
    stunted: integer
    severely_stunted: integer

  # Interventions
  referred_for_intervention: integer
  receiving_supplementation: integer
```

---

## US-13.4: BPJS Claims Report

### User Story
**As a** billing manager
**I want to** generate BPJS claims reports
**So that** revenue and claim status are monitored

### Acceptance Criteria

- [ ] **GIVEN** period is selected
      **WHEN** generating BPJS report
      **THEN** system shows claim summary with status breakdown

### Data Model

```yaml
bpjs_monthly_report:
  period_month: integer
  period_year: integer

  # Summary
  total_bpjs_patients: integer
  total_sep_created: integer

  # By service type
  outpatient:
    visits: integer
    claims_submitted: integer
    claims_approved: integer
    claims_pending: integer
    claims_rejected: integer
    amount_claimed: decimal
    amount_approved: decimal

  inpatient:
    admissions: integer
    claims_submitted: integer
    claims_approved: integer
    claims_pending: integer
    claims_rejected: integer
    amount_claimed: decimal
    amount_approved: decimal
    avg_los_days: decimal

  # INA-CBG analysis
  inacbg_analysis:
    - cbg_code: string
      cbg_name: string
      count: integer
      avg_tariff: decimal
      total_tariff: decimal

  # Rejection analysis
  rejections:
    - reason: string
      count: integer
      amount: decimal

  # Aging
  claims_aging:
    under_7_days: integer
    7_to_30_days: integer
    over_30_days: integer

bpjs_comparison_report:
  period_month: integer
  period_year: integer

  # Month over month
  mom_comparison:
    current_revenue: decimal
    previous_revenue: decimal
    change_percent: decimal

  # Year over year
  yoy_comparison:
    current_revenue: decimal
    previous_year_revenue: decimal
    change_percent: decimal

  # Trends
  monthly_trends:
    - month: string
      claims: integer
      approved: decimal
      rejected: decimal
```

---

## US-13.5: Dinas Kesehatan Reports

### User Story
**As a** clinic administrator
**I want to** generate reports for Dinas Kesehatan
**So that** regulatory reporting requirements are met

### Acceptance Criteria

- [ ] **GIVEN** reporting period ends
      **WHEN** generating Dinkes report
      **THEN** system produces standard format report

### Required Reports

```yaml
laporan_bulanan_puskesmas:
  # LB1 - Kesakitan
  lb1:
    total_visits: integer
    by_disease: array[{icd10, name, new, returning, total}]

  # LB2 - Obat
  lb2:
    total_prescriptions: integer
    by_drug: array[{name, quantity, unit}]

  # LB3 - Gizi
  lb3:
    children_weighed: integer
    underweight: integer
    severely_underweight: integer
    stunted: integer

  # LB4 - KIA
  lb4:
    pregnant_registered: integer
    k1: integer
    k4: integer
    deliveries: integer
    immunizations: object

laporan_sp2tp:
  period_month: integer
  period_year: integer
  facility_code: string
  facility_name: string

  # SP2TP components
  kunjungan_rawat_jalan: integer
  kunjungan_rawat_inap: integer
  rujukan_keluar: integer
  rujukan_masuk: integer

  # By age group
  kunjungan_by_age:
    - age_group: string
      male: integer
      female: integer

laporan_satusehat_summary:
  period_month: integer
  period_year: integer

  # Sync statistics
  resources_synced:
    - resource_type: string
      total_attempted: integer
      successful: integer
      failed: integer
      pending: integer

  # Encounter coverage
  encounters_created: integer
  encounters_synced: integer
  sync_rate_percent: decimal

  # Errors
  common_errors:
    - error_type: string
      count: integer
```

---

## Report Generation & Export

### Data Model

```yaml
report_definition:
  id: uuid
  report_code: string (unique)
  report_name: string
  report_category: enum (operational/clinical/financial/regulatory)

  # Schedule
  frequency: enum (daily/weekly/monthly/on_demand)
  auto_generate: boolean (default: false)
  generate_day: integer (nullable) # day of week/month

  # Parameters
  parameters: jsonb # configurable parameters

  # Output
  output_formats: array[enum] # pdf, excel, csv

  is_active: boolean (default: true)

report_generation:
  id: uuid
  report_definition_id: uuid (FK)

  # Parameters used
  parameters: jsonb
  period_start: date
  period_end: date

  # Generation
  requested_at: datetime
  requested_by: uuid (FK)
  generated_at: datetime (nullable)
  generation_status: enum (pending/processing/completed/failed)
  error_message: text (nullable)

  # Output
  file_url: string (nullable)
  file_format: enum (pdf/excel/csv)
  file_size_bytes: integer (nullable)

  # Expiry
  expires_at: datetime

report_schedule:
  id: uuid
  report_definition_id: uuid (FK)

  # Schedule
  frequency: enum (daily/weekly/monthly)
  schedule_time: time
  schedule_day: integer (nullable) # 1-7 for weekly, 1-31 for monthly

  # Recipients
  auto_email: boolean (default: false)
  email_recipients: array[string]

  # Status
  is_active: boolean (default: true)
  last_run_at: datetime (nullable)
  next_run_at: datetime
```

---

## Dashboard Widgets

### Executive Dashboard

```yaml
executive_dashboard:
  # Real-time
  realtime:
    patients_waiting: integer
    active_consultations: integer
    pharmacy_queue: integer
    lab_queue: integer

  # Today
  today:
    total_visits: integer
    total_revenue: decimal
    bpjs_visits: integer
    new_registrations: integer

  # This month
  monthly:
    visits_trend: array[{date, count}]
    revenue_trend: array[{date, amount}]
    target_achievement: decimal

  # Alerts
  alerts:
    - type: string
      message: string
      severity: enum
      count: integer
```

---

## Dependencies
- All clinical modules (data sources)
- Billing (financial data)
- BPJS Integration (claims data)

## Blocks
- Decision support systems
- Predictive analytics

